# 次の作業指示 - イベント詳細ページの改善
components/parts/event/imp.md

## 現状
フェーズ1が完了しました。基本的な画像・PDFダウンロード機能が実装されています。

## 次に実施すべき作業

### 1. 画像最適化の実装（推奨度: 高）
**目的**: ダウンロードした画像をWebP形式に変換し、複数解像度を生成する

**実装内容**:
```
components/download/event.js を改修して、既存のImageOptimizerのロジックを活用し、
画像を最適化（WebP変換、複数サイズ生成）する機能を追加してください。
```

**期待される効果**:
- ページ読み込み速度の向上
- データ転送量の削減
- レスポンシブ対応の改善

### 2. エラーハンドリングの強化（推奨度: 中）
**目的**: ダウンロード失敗時の対処を改善

**実装内容**:
```
components/download/event.js にリトライ処理と詳細なエラーログを追加し、
ダウンロード失敗時にも適切にフォールバック処理が行われるようにしてください。
```

### 3. ニュース詳細ページへの同機能適用（推奨度: 高）
**目的**: ニュース詳細ページでも同様の機能を利用可能にする

**実装内容**:
```
components/pages/news/detail.js も同様に改修し、
ニュース記事の画像・PDFもローカル化してください。
共通化できる部分はリファクタリングしてください。
```

### 4. キャッシュ戦略の実装（推奨度: 低〜中）
**目的**: Notionコンテンツ更新時の自動再ダウンロード

**実装内容**:
```
Notionのlast_edited_timeを活用して、
更新があった場合のみ再ダウンロードする機能を実装してください。
```

## 推奨される実施順序

1. **画像最適化の実装**（最優先）
   - パフォーマンス改善効果が大きい
   - 既存のImageOptimizerロジックを活用可能

2. **ニュース詳細ページへの適用**
   - イベントと同様の問題を抱えているため重要
   - コードの共通化も同時に実施

3. **エラーハンドリングの強化**
   - 安定性向上のため実施

4. **キャッシュ戦略**（時間があれば）
   - 運用効率の改善

## 実装時の注意事項

- 既存の`components/download/index.js`のImageOptimizer処理を参考にする
- sharpライブラリを使用したWebP変換を実装
- ファイルサイズと画質のバランスを考慮（quality: 80推奨）
- 複数解像度の生成（sm: 480px, md: 800px, lg: 1200px, xl: 1600px）
- エラー時は必ずNotionのURLへフォールバック

## 作業開始のプロンプト例

```
「components/download/event.jsに画像最適化機能を追加してください。
既存のcomponents/download/index.jsのprocessAndSaveImage関数を参考に、
WebP変換と複数解像度生成を実装してください。」
```

または

```
「ニュース詳細ページ（components/pages/news/detail.js）にも
イベント詳細ページと同様の画像・PDFローカル化機能を適用してください。」
```