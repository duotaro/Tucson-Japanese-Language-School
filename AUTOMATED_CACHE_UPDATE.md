# Notionデータ更新とサイト自動デプロイの仕組みについて

## 1. 課題 (ご質問内容)

開発者ではないサイト運営者が、コマンドライン操作なしでNotion上のデータを更新し、それを本番サイトに反映させるための、簡単で確実な方法を確立したい。

現状では、キャッシュの更新に `yarn cache:fetch-all` というコマンドを手動で実行する必要があり、専門知識のない運営者には実施が困難である。

## 2. 提案内容 (Geminiより)

GitHub Actionsを利用し、Notionのデータ更新からキャッシュ生成、サイトのデプロイまでを完全に自動化する仕組みを構築する。

**具体的なアプローチ:**

*   **トリガー:** 定期実行（Cron Job）またはNotionの更新通知（Webhook）をきっかけに、自動化プロセスを開始する。
*   **処理内容:**
    1.  GitHub Actionsが起動。
    2.  `yarn cache:fetch-all` などのコマンドを実行し、Notionから最新データを取得してキャッシュファイル（JSON）を更新する。
    3.  更新されたキャッシュファイルをGitリポジトリに自動でコミット＆プッシュする。
    4.  リポジトリへのプッシュをトリガーとして、既存のデプロイワークフローが起動し、最新のサイトがビルドされ、Firebaseへ自動でデプロイされる。

## 3. 現状の分析

調査の結果、ご要望の仕組みは、`.github/workflows/cache-scheduler.yml` というファイルで**すでに実装済み**であることが判明した。

このワークフローは、定期的な自動実行と、GitHubの画面からの手動実行の両方に対応しており、キャッシュの更新からリポジトリへの反映までを自動で行う、非常に高度な仕組みとなっている。

**現状、この自動化が機能していない原因は、ワークフローが必要とするAPIキーやトークンが、GitHubリポジトリのSecretsに設定されていないため**と推測される。

## 4. 今後の対応方針 (To-Do)

以下の手順で、既存の自動化の仕組みを有効化する。

1.  **Secret名の統一 (本日の対応):**
    *   現在、キャッシュ更新処理 (`cache-scheduler.yml`) とビルド処理 (`deploy.yml`) で、Notion APIキーを参照するSecret名が `NOTION_TOKEN` と `NOTION_API_KEY` の2種類に分かれている。
    *   これを `NOTION_API_KEY` に統一し、管理を容易にする。

2.  **GitHub Secretsの設定 (お客様によるご対応):**
    *   以下の情報を、GitHubリポジトリの `Settings > Secrets and variables > Actions` に設定する。
        *   `NOTION_API_KEY`: NotionインテグレーションのAPIキー。
        *   `NEXT_PUBLIC_NOTION_DATABASE_ID`: NotionのメインデータベースID。
        *   `NEXT_PUBLIC_NOTION_NEWS_DATABASE_ID`: Notionのニュース用データベースID。
        *   `FIREBASE_TOKEN`: Firebaseプロジェクトにアクセスするための認証トークン。
    *   **これらの値は秘匿情報であり、私（Gemini）が直接設定することはできないため、お客様ご自身での設定が必要。**

上記が完了すれば、サイト運営者様は**Notionの情報を更新するだけ**で、定期的に、または手動実行によって、サイトが自動で更新されるようになります。
