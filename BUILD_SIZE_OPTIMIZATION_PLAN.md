# ビルドサイズ削減プロジェクト計画書

**プロジェクト目標**: ビルドサイズ40-50%削減（201MB → 100-120MB）  
**作成日**: 2025-07-12  
**対象**: ツーソン日本語学校ウェブサイト  

---

## 📊 現状分析

### 問題の詳細
- **現在のビルドサイズ**: 201MB（IMPROVEMENT_PROPOSAL.md参照）
- **主要課題**: 
  - 画像最適化無効化（`images.unoptimized = true`）
  - CSS最適化不足（全要素transition適用）
  - バンドル分割不十分
  - Dynamic imports未活用

### 期待効果
- **ビルドサイズ**: 201MB → 100-120MB（40-50%削減）
- **初期表示速度**: 30%向上予測
- **First Contentful Paint**: 改善
- **Largest Contentful Paint**: 改善

---

## 🎯 実装フェーズ

### Phase 1: 緊急対応（最高優先度）
**期間**: 1-2週間  
**目標**: 即座にビルドサイズ削減効果が見込める施策

#### 1. 画像最適化設定変更
- **現在**: `images: { unoptimized: true }`
- **変更後**: Next.js画像最適化を有効化
- **期待効果**: ビルドサイズ30-40%削減

#### 2. Critical CSS分離
- **現在**: 全要素にtransition適用
- **変更後**: Above-the-fold用CSS分離、残りは遅延読み込み
- **期待効果**: 初期CSS読み込み量削減

#### 3. webpack バンドル最適化
- **実装**: chunk分割、コードスプリッティング
- **対象**: React、Notion API、共通コンポーネント別chunk化
- **期待効果**: JavaScript初期ロード削減

### Phase 2: 中期改善（高優先度）
**期間**: 3-4週間  
**目標**: さらなる最適化とパフォーマンス向上

#### 4. Dynamic imports導入
- **対象**: 大きなコンポーネント（ニュース詳細、スライダーなど）
- **実装**: 遅延読み込み + ローディング状態
- **期待効果**: JavaScript初期ロード50%削減

#### 5. Notion API最適化
- **現在**: 全プロパティ取得
- **改善**: 必要プロパティのみ選択取得
- **期待効果**: データ転送量削減

### Phase 3: 継続監視（中優先度）
**期間**: 継続的  
**目標**: 最適化効果の継続監視と改善

#### 6. バンドルアナライザー導入
- **ツール**: @next/bundle-analyzer
- **目的**: ビルドサイズ構成要素の可視化
- **効果**: 継続的な問題特定と改善

#### 7. パフォーマンステスト自動化
- **実装**: 各最適化後の効果測定
- **監視項目**: ビルドサイズ、Core Web Vitals
- **目的**: 改善効果の定量評価

---

## 📋 タスク詳細

### 高優先度タスク
1. **現在のビルドサイズ分析** - 構成要素の詳細把握
2. **画像最適化設定変更** - next.config.js修正
3. **Critical CSS分離** - パフォーマンス向上
4. **webpack最適化** - バンドル分割設定

### 中優先度タスク
5. **Dynamic imports実装** - 大きなコンポーネント対象
6. **Notion API最適化** - データ取得効率化
7. **バンドルアナライザー設定** - 継続監視体制
8. **効果測定テスト** - 各段階での効果確認

---

## ⚠️ 実装上の注意事項

### 画像最適化有効化時
- Notion画像URLの処理変更が必要な可能性
- 開発環境での十分なテスト必要
- Firebase Hosting設定確認

### Dynamic imports導入時
- SEOに影響しないよう重要コンテンツは同期読み込み維持
- 適切なローディングステート実装
- エラーバウンダリ設定

### CSS最適化時
- Above-the-fold特定の精度
- スタイル適用タイミングの調整
- 視覚的な変化が生じないよう注意

---

## 📈 成功指標

### 定量指標
- **ビルドサイズ**: 201MB → 100-120MB達成
- **初期表示速度**: 30%向上
- **Lighthouse Performance Score**: 15-20点向上
- **First Contentful Paint**: 改善

### 定性指標
- ユーザー体験の向上
- ページ読み込み速度体感向上
- モバイル環境での利用改善

---

## 🔄 継続改善サイクル

1. **実装** → 2. **測定** → 3. **分析** → 4. **改善**

### 監視項目
- ビルドサイズ推移
- Core Web Vitals指標
- エラー発生状況
- ユーザーフィードバック

### レビュー頻度
- **週次**: 実装進捗確認
- **月次**: パフォーマンス指標レビュー
- **四半期**: 総合的な効果評価

---

**このプロジェクトは段階的な実装により、確実なビルドサイズ削減とパフォーマンス向上を目指します。**